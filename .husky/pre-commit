#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Check if this is production build
if [ "$NODE_ENV" = "production" ]; then
  echo "🔍 Production build - running strict checks..."

  # TypeScript type checking
  echo "📝 Type checking..."
  npx tsc --noEmit

  # ESLint checking
  echo "🔍 Linting..."
  npx next lint

  # Security audit
  echo "🔒 Security audit..."
  npm audit --audit-level moderate

  # Test critical paths
  echo "🧪 Running critical tests..."
  npm run test -- --testPathPattern="critical|auth|security"
else
  echo "🏗️ Development build - running basic checks..."

  # Run lint-staged for staged files only
  npx lint-staged

  # Basic type checking (ignore minor errors in dev)
  npx tsc --noEmit --skipLibCheck || echo "⚠️  Type errors found (continuing in dev mode)"
fi

echo "✅ Pre-commit checks completed"
